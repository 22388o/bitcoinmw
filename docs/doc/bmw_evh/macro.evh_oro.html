<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The `crate::evh_oro!` macro builds a `crate::EventHandler` implementation. This is a simplified version of the `crate::evh!` macro. It allows the user to not have to specify the handlers other than the `crate::EventHandler::set_on_read` handler. Hence, it is called `evh_oro` (evh on read only). This macro is useful for testing, but also for simple use cases where only on read processing is necessary. It can allow the user to avoid specifying the unused boilerplate code that is required since all of the handlers must be specified with the `crate::evh!` macro. The result is returned as a `Box&lt;dyn EventHandler&lt;OnRead, OnAccept, OnClose, OnHousekeeper, OnPanic&gt; + Send + Sync&gt;`. If an error occurs, a `bmw_err::Error` is rerurned."><title>evh_oro in bmw_evh - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="bmw_evh" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0 (aedd173a2 2024-03-17)" data-channel="1.77.0" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../bmw_evh/index.html">bmw_evh</a><span class="version">0.0.3-beta.1</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../bmw_evh/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Macro <a href="index.html">bmw_evh</a>::<wbr><a class="macro" href="#">evh_oro</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/bmw_evh/macros.rs.html#276-311">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><span class="macro">macro_rules! </span>evh_oro {
    ($(<span class="macro-nonterminal">$config</span>:tt)<span class="kw-2">*</span>) =&gt; { ... };
}</pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The <a href="macro.evh_oro.html" title="macro bmw_evh::evh_oro"><code>crate::evh_oro!</code></a> macro builds a <a href="trait.EventHandler.html" title="trait bmw_evh::EventHandler"><code>crate::EventHandler</code></a> implementation. This is a simplified
version of the <a href="macro.evh.html" title="macro bmw_evh::evh"><code>crate::evh!</code></a> macro. It allows the user to not have to specify the handlers
other than the <a href="trait.EventHandler.html#tymethod.set_on_read" title="method bmw_evh::EventHandler::set_on_read"><code>crate::EventHandler::set_on_read</code></a> handler. Hence, it is called <code>evh_oro</code> (evh on read
only). This macro is useful for testing, but also for simple use cases where only on read
processing is necessary. It can allow the user to avoid specifying the unused boilerplate code
that is required since all of the handlers must be specified with the <a href="macro.evh.html" title="macro bmw_evh::evh"><code>crate::evh!</code></a> macro.
The result is returned as a
<code>Box&lt;dyn EventHandler&lt;OnRead, OnAccept, OnClose, OnHousekeeper, OnPanic&gt; + Send + Sync&gt;</code>. If an
error occurs, a [<code>bmw_err::Error</code>] is rerurned.</p>
<h2 id="input-parameters"><a class="doc-anchor" href="#input-parameters">§</a>Input Parameters</h2>
<ul>
<li>EvhThreads (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html" title="primitive usize"><code>usize</code></a>) (optional) - The number of threads for this
<a href="trait.EventHandler.html" title="trait bmw_evh::EventHandler"><code>crate::EventHandler</code></a>. The default value is 4.</li>
<li>EvhReadSlabSize (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html" title="primitive usize"><code>usize</code></a>) (optional) - The size of the slabs, in bytes, in the read slab
allocator. The read slab allocator is where request data is temporarily stored before it can be
processed and cleared. Each thread has it’s own dedicated slab allocator. The default value is 512.</li>
<li>EvhReadSlabCount (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html" title="primitive usize"><code>usize</code></a>) (optional) - The count of the slabs, in the read slab
allocator. The read slab allocator is where request data is temporarily stored before it can be
processed and cleared. Each thread has it’s own dedicated slab allocator. The default value is
1_000.</li>
<li>EvhTimeout (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.u16.html" title="primitive u16"><code>u16</code></a>) (optional) - The time, in milliseconds that the event handler will
wait to get events, if none occur. This value is important for things like the house keeping
frequency and stats configurations because if no events occur and this value is too great, a
house keeper or stats action will not occur until this timeout occurs. If too small a number is
used, too many needless events occur, if too big, the periodic tasks will not occur until later
than desired. The default value is set to 1_000 (1 second).</li>
<li>EvhHouseKeeperFrequencyMillis (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html" title="primitive usize"><code>usize</code></a>) (optional) - The frequency, in milliseconds,
at which the housekeeper callback is called. The housekeeper closure is set by the
<a href="trait.EventHandler.html#tymethod.set_on_housekeeper" title="method bmw_evh::EventHandler::set_on_housekeeper"><code>crate::EventHandler::set_on_housekeeper</code></a> function. It is important to note that each thread
executes it’s own housekeeper function. The default value is 10_000 (10 seconds).</li>
<li>EvhStatsUpdateMillis (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.usize.html" title="primitive usize"><code>usize</code></a>) - The frequency, in milliseconds, at which the stats
data is returned. The stats data may be retrieved by calling the
<a href="trait.EventHandler.html#tymethod.wait_for_stats" title="method bmw_evh::EventHandler::wait_for_stats"><code>crate::EventHandler::wait_for_stats</code></a> function. The default value is 5_000 (5 seconds).</li>
<li>Debug (<a href="https://doc.rust-lang.org/1.77.0/std/primitive.bool.html" title="primitive bool"><code>bool</code></a>) - If this parameter is set to true, additional debugging information will be
logged. This parameter must NOT be set in a production configuration.</li>
</ul>
<h2 id="returns"><a class="doc-anchor" href="#returns">§</a>Returns</h2>
<p>A <code>Ok(Box&lt;dyn EventHandler&lt;OnRead, OnAccept, OnClose, OnHousekeeper, OnPanic&gt; + Send + Sync&gt;)</code>
is returned on success. A [<code>bmw_err::Error</code>] is returned on failure.</p>
<h2 id="errors"><a class="doc-anchor" href="#errors">§</a>Errors</h2>
<ul>
<li>[<code>bmw_err::ErrKind::Configuration</code>] - If any values are specified other than the allowed
values mentioned above or if there are any duplicate parameters specified.</li>
<li>[<code>bmw_err::ErrKind::Configuration</code>] - If EvhReadSlabCount is 0.</li>
<li>[<code>bmw_err::ErrKind::Configuration</code>] - If EvhReadSlabSize is less than 25.</li>
<li>[<code>bmw_err::ErrKind::Configuration</code>] - If EvhTimeout is 0.</li>
<li>[<code>bmw_err::ErrKind::Configuration</code>] - If EvhHouseKeeperFrequencyMillis is 0.</li>
</ul>
<h2 id="see-also"><a class="doc-anchor" href="#see-also">§</a>See also</h2>
<p>See the <a href="index.html" title="mod bmw_evh"><code>crate</code></a> documentation as well for the background information and motivation
for this crate as well as examples.</p>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code> <span class="kw">use </span>bmw_err::<span class="kw-2">*</span>;
 <span class="kw">use </span>bmw_test::<span class="kw-2">*</span>;
 <span class="kw">use </span>bmw_evh::<span class="kw-2">*</span>;
 <span class="kw">use </span>bmw_log::<span class="kw-2">*</span>;
 <span class="kw">use </span>std::str::from_utf8;

 <span class="macro">info!</span>();

 <span class="kw">fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Error&gt; {
     <span class="comment">// create an evh with the specified configuration. The unspecified values are
     // the defaults mentioned above.
     </span><span class="kw">let </span><span class="kw-2">mut </span>evh = <span class="macro">evh_oro!</span>(
         EvhTimeout(<span class="number">100</span>),
         EvhThreads(<span class="number">1</span>),
         EvhReadSlabSize(<span class="number">100</span>),
         EvhStatsUpdateMillis(<span class="number">5000</span>),
         Debug(<span class="bool-val">true</span>)
     )<span class="question-mark">?</span>;

     <span class="comment">// set the on read handler
     </span>evh.set_on_read(<span class="kw">move </span>|connection, ctx| -&gt; <span class="prelude-ty">Result</span>&lt;(), Error&gt; {
         <span class="comment">// loop through each of the available chunks and append data to a vec.
         </span><span class="kw">let </span><span class="kw-2">mut </span>data: Vec&lt;u8&gt; = <span class="macro">vec!</span>[];

         <span class="kw">loop </span>{         
             <span class="kw">let </span>next_chunk = ctx.next_chunk(connection)<span class="question-mark">?</span>;
             <span class="macro">cbreak!</span>(next_chunk.is_none());
             <span class="kw">let </span>next_chunk = next_chunk.unwrap();
             data.extend(next_chunk.data());
         }  

         <span class="comment">// convert returned data to a utf8 string
         </span><span class="kw">let </span>dstring = from_utf8(<span class="kw-2">&amp;</span>data)<span class="question-mark">?</span>;
         <span class="macro">info!</span>(<span class="string">"data[{}]='{}'"</span>, connection.id(), dstring)<span class="question-mark">?</span>;

         <span class="comment">// get a write handle
         </span><span class="kw">let </span><span class="kw-2">mut </span>wh = connection.write_handle()<span class="question-mark">?</span>;

         <span class="comment">// echo
         </span>wh.write(dstring.as_bytes())<span class="question-mark">?</span>;

         <span class="comment">// clear all chunks from this connection. Note that partial
         // clearing is possible with the ctx.clear_through function
         // or no data can be cleared at all in which case it can
         // be accessed on a subsequent request. When the connection
         // is closed, all data is cleared automatically.
         </span>ctx.clear_all(connection)<span class="question-mark">?</span>;

         <span class="prelude-val">Ok</span>(())
     })<span class="question-mark">?</span>;

     <span class="comment">// no other handlers are necessary

     </span>evh.start()<span class="question-mark">?</span>;

     <span class="prelude-val">Ok</span>(())
 }</code></pre></div>
</div></details></section></div></main></body></html>